<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peeble - Connecting Hearts</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>ðŸª¨ Peeble</h1>
            <p>Voice messages across languages & distances</p>
        </div>

        <!-- Pinata API Setup - This section will be hidden once credentials are saved -->
        <div class="api-setup" id="apiSetup">
            <h3>ðŸ”‘ Pinata IPFS Setup (Testing Only)</h3>
            <div class="api-input">
                <input type="text" id="pinataApiKey" placeholder="Pinata API Key" />
                <input type="password" id="pinataSecret" placeholder="Pinata Secret" />
                <button class="btn btn-small" onclick="window.testPinataConnection()">Test Connection</button>
            </div>
            <p style="font-size: 0.8em; color: #718096; margin-top: 10px;">
                Get free API keys at <a href="https://pinata.cloud" target="_blank">pinata.cloud</a> â†’ API Keys â†’ New Key
                <br><strong>Required permissions:</strong> pinFileToIPFS
            </p>
            <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: #5a67d8;">ðŸ”§ Troubleshooting</summary>
                <div style="margin-top: 10px; font-size: 0.85em; color: #4a5568;">
                    <p><strong>If upload fails:</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.4;">
                        <li>Check the debug console below for detailed errors</li>
                        <li>Ensure API key has "pinFileToIPFS" permission</li>
                        <li>Try a shorter recording (file size limits)</li>
                        <li>Check your Pinata account usage/quota</li>
                    </ul>
                </div>
            </details>
        </div>

        <!-- Debug Console Component -->
        <debug-console></debug-console>

        <!-- Main Peeble App Component - This will render either voice-recorder or message-player -->
        <peeble-app></peeble-app>

        <!-- NFC Handler Component - For actual NFC interactions -->
        <nfc-handler></nfc-handler>
    </div>

    <!-- Load Services -->
    <script type="module" src="services/encryption.js"></script>
    <script type="module" src="services/storage.js"></script>
    <script type="module" src="services/nfc.js"></script>
    <script type="module" src="services/audio.js"></script>
    <script type="module" src="services/utils.js"></script> <!-- Consolidated utilities -->

    <!-- Load Components -->
    <script type="module" src="components/debug-console.js"></script>
    <script type="module" src="components/voice-recorder.js"></script>
    <script type="module" src="components/message-player.js"></script>
    <script type="module" src="components/nfc-handler.js"></script>
    <script type="module" src="components/peeble-app.js"></script>

    <!-- Main App Initialization -->
    <script type="module" src="main.js"></script>
</body>
</html>
